; STANDARD HEADER FILE
	PROCESSOR	16F876
;
; BANK 0
INDF	EQU	00H
TMR0	EQU	01H
PCL		EQU	02H
STATUS	EQU	03H
FSR		EQU	04H
PORTA	EQU	05H
PORTB	EQU	06H
PORTC	EQU	07H
EEDATA	EQU	08H
EEADR	EQU	09H
PCLATH	EQU	0AH
INTCON	EQU	0BH
RCSTA	EQU	18H
TXREG	EQU	19H
; BANK 1
OPTIONR	EQU	81H
TRISA	EQU	85H
TRISB	EQU	86H
TRISC	EQU	87H
EECON1	EQU	88H
EECON2	EQU	89H
TXSTA	EQU	98H
SPBRG	EQU	99H
ADCON1	EQU	9FH
;
IRP		EQU	7
RP1		EQU	6
RP0		EQU	5
NOT_TO	EQU	4
NOT_PD	EQU	3
ZF		EQU	2
DC		EQU	1
CF		EQU	0
;
;

W		EQU	B'0'
F		EQU	.1
DBUF0	EQU	23H
DBUF1 	EQU 24H ;
DBUF2 	EQU 25H ;
DBUF3 	EQU 26H ;
D_1MIN	EQU 27H
D_10MIN	EQU	28H
INT_CNT	EQU	30H
D_10SEC	EQU	31H
D_1SEC	EQU	32H
MOD_CNT	EQU	33H
W_TEMP	EQU	34H
STATUS_TEMP	EQU	35H
DISP_CNT	EQU	36H
D_1HOUR	EQU	37H
D_10HOUR	EQU	38H
C_CNT	EQU	39H
CNT		EQU	40H
A_1SEC	EQU	41H
A_10SEC	EQU	42H
A_1MIN	EQU	43H
A_10MIN	EQU	44H
A_1HOUR	EQU	45H
A_10HOUR	EQU	46H
A_CNT	EQU	47H
TEMP	EQU	48H
TEMP2	EQU	49H	;;사용할 변수들 저장

;
ORG		0
GOTO	START_UP
ORG		4		;;ISR 내부 코드 작성 시작
;
MOVWF	W_TEMP
SWAPF	STATUS,W
MOVWF	STATUS_TEMP
MOVF	MOD_CNT,W	;;모드변경 값 확인
SUBLW	.1			
BTFSS	STATUS,ZF	
GOTO	MS1			
CALL	SEC			;모드변경 값이 1이면 초 시계
GOTO	RETURN_INT	

MS1
	MOVF	MOD_CNT,W
	SUBLW	.3
	BTFSS	STATUS,ZF
	GOTO	MS2		;default와 모드2는 동일한 시간 표시 루틴 사용함
	CALL	ALARM_DISP	;모드변경 값이 3이면 알람 설정 값 표시 루틴으로
	GOTO	RETURN_INT
MS2
	CALL	DISP	;시/분 표시 루틴으로
	
RETURN_INT			;인터럽트 처리 완료하고 다시 메인문으로 가기 위한 코드
	SWAPF	STATUS_TEMP,W
	MOVWF	STATUS
	SWAPF	W_TEMP,F
	SWAPF	W_TEMP,W
	BCF		INTCON,2
	RETFIE
;
ALARM_DISP			;알람 설정 기능에서 시/분 표시를 위한 routine
	BSF		PORTA,2
	BSF		PORTA,3
	BSF		PORTB,2
	BSF		PORTB,1
	INCF	DISP_CNT,
	MOVF	DISP_CNT,W
	ANDLW	03	
	ADDWF	PCL,F	;lookup table 이용해 시/분 표시를 한다.
	GOTO	AL_DISP1
	GOTO	AL_DISP2
	GOTO	AL_DISP3
	GOTO	AL_DISP4

SEC					;초 표시를 위한 routine
	BTFSC	DISP_CNT,0
	GOTO	SEC_10
	GOTO	SEC_1

	
SEC_10
	BSF		PORTA,2
	BSF		PORTA,3
	BSF		PORTB,2
	BSF		PORTB,1
	MOVF	D_10SEC,W
	CALL	CONV
	MOVWF	PORTC
	BCF		PORTB,2
	INCF	DISP_CNT
	RETURN
SEC_1
	BSF		PORTA,2
	BSF		PORTA,3
	BSF		PORTB,2
	BSF		PORTB,1
	MOVF	D_1SEC,W
	CALL	CONV
	MOVWF	PORTC
	BCF		PORTB,1
	INCF	DISP_CNT
	INCF	INT_CNT
	RETURN
	

;DISPLAY ROUTINE
DISP				;시/분 표시
	BTFSC	DISP_CNT,0
	GOTO	CHECK1
	GOTO	CHECK2
CHECK1			;분 표시 분기문
	BTFSC	DISP_CNT,1
	GOTO	DISP1
	GOTO	DISP2
CHECK2			;시 표시 분기문 
	BTFSC	DISP_CNT,1
	GOTO	DISP3
	GOTO	DISP4
DISP1;<10Min>
	BSF		PORTA,2
	BSF		PORTA,3
	BSF		PORTB,2
	BSF		PORTB,1
	MOVF	D_10MIN,W
	CALL	CONV
	MOVWF	PORTC
	BCF		PORTB,2
	INCF	DISP_CNT
	RETURN
DISP2;<1Min>
	BSF		PORTA,2
	BSF		PORTA,3
	BSF		PORTB,2
	BSF		PORTB,1
	MOVF	D_1MIN,W
	CALL	CONV
	MOVWF	PORTC
	
	BCF		PORTB,1
	INCF	DISP_CNT
	INCF	INT_CNT
	RETURN

DISP3;<10Hour>
	BSF		PORTA,2
	BSF		PORTA,3
	BSF		PORTB,2
	BSF		PORTB,1
	MOVF	D_10HOUR,W
	CALL	CONV
	MOVWF	PORTC

	BCF		PORTA,3
	INCF	DISP_CNT
	RETURN

DISP4;<1Hour>
	BSF		PORTA,2
	BSF		PORTA,3
	BSF		PORTB,2
	BSF		PORTB,1
	MOVF	D_1HOUR,W
	CALL	CONV
	MOVWF	PORTC
	;
	MOVLW	.121		;default상태에서 초가 흐르는 것을 확인하기 위해 점을 깜박이게 함
	SUBWF	INT_CNT,W
	BTFSC	STATUS,ZF
	CALL	DOT_ONOFF
	;
	MOVLW	.0
	SUBWF	INT_CNT,W
	BTFSC	STATUS,ZF
	CALL	DOT_ONOFF
	;

	BCF	PORTA,2
	INCF	DISP_CNT
	INCF	INT_CNT
	RETURN
DOT_ONOFF			;exclusive Or 이용해 깜박거리게 함
	MOVLW	B'00000001'
	XORWF	PORTC
	RETURN
;--------------------------------

;MAIN PROGRAM
START_UP
	BSF	STATUS,RP0
	MOVLW	B'00000111'
	MOVWF	ADCON1
	MOVLW	B'11100000'
	MOVWF	TRISA
	MOVLW	B'11111000'
	MOVWF	TRISB
	MOVLW	B'00000000'
	MOVWF	TRISC
	MOVLW	B'00000010';2.048msec
	MOVWF	OPTIONR
	BCF		STATUS,RP0
	BSF		INTCON,5;TIMER INTERRUPT ENABLE
	BSF		INTCON,7;GLOBAL INTERRUPT ENABLE
	GOTO	MAIN_ST
	
CONV			;모드 변경 및 알람 설정시 dot 깜박이게 하기 위해 dot을 켜주는 Fnd 값 16개, 끄는 Fnd값 16개 총 32개
	ANDLW	1FH
	ADDWF	PCL,F
		
	RETLW	B'11111100' ;'0'
	RETLW	B'01100000'	;'1'
	RETLW	B'11011010'	;'2'
	RETLW	B'11110010'	;'3'
	RETLW	B'01100110'	;'4'
	RETLW	B'10110110'	;'5'
	RETLW	B'10111110'	;'6'
	RETLW	B'11100000'	;'7'
	RETLW	B'11111110'	;'8'
	RETLW	B'11110110'	;'9'
	RETLW	B'00010001'
	RETLW	B'11000001'
	RETLW	B'01100011'
	RETLW	B'10000101'
	RETLW	B'01100001'
	RETLW	B'01110001'
	;
	RETLW	B'11111101' ;'0'
	RETLW	B'01100001'	;'1'
	RETLW	B'11011011'	;'2'
	RETLW	B'11110011'	;'3'
	RETLW	B'01100111'	;'4'
	RETLW	B'10110111'	;'5'
	RETLW	B'10111111'	;'6'
	RETLW	B'11100001'	;'7'
	RETLW	B'11111111'	;'8'
	RETLW	B'11110111'	;'9'
	RETLW	B'00010001'
	RETLW	B'11000001'
	RETLW	B'01100011'
	RETLW	B'10000101'
	RETLW	B'01100001'
	RETLW	B'01110001'
	
DOTON		;시간 변경 기능 시 dot on
	MOVF	C_CNT,W
	ANDLW	03
	ADDWF	PCL,F
	GOTO	DON1
	GOTO	DON2
	GOTO	DON3
	GOTO	DON4
DOTOFF		;시간 변경 기능 시 dot off
	MOVF	C_CNT,W
	ANDLW	03
	ADDWF	PCL,F
	GOTO	DOFF1
	GOTO	DOFF2
	GOTO	DOFF3
	GOTO	DOFF4

ALARM_DOTON	;알람 설정 시 dot on
	MOVF	A_CNT,W
	ANDLW	03
	ADDWF	PCL,F
	GOTO	AD1
	GOTO	AD2
	GOTO	AD3
	GOTO	AD4
	
ALARM_DOTOFF ;알람 설정 시 dot off
	MOVF	A_CNT,W
	ANDLW	03
	ADDWF	PCL,F
	GOTO	ADO1
	GOTO	ADO2
	GOTO	ADO3
	GOTO	ADO4

	
INCE		;시간 변경 값 증가
	MOVF	C_CNT,W
	ANDLW	03H
	ADDWF	PCL,F
	GOTO	INC_1
	GOTO	INC_2
	GOTO	INC_3
	GOTO	INC_4

INCE_A		;알람 설정 값 증가
	MOVF	A_CNT,W
	ANDLW	03H
	ADDWF	PCL,F
	GOTO	INC_A1
	GOTO	INC_A2
	GOTO	INC_A3
	GOTO	INC_A4

TIMEUP_AL	;10시간 자리수가 2를 넘어가면 모든 값 초기화 
	MOVF	A_10HOUR,W
	ANDLW	0FH
	SUBLW	.2
	BTFSS	STATUS,ZF
	RETURN
	CLRF	A_1MIN
	CLRF	A_10MIN
	CLRF	A_1HOUR
	CLRF	A_10HOUR
	RETURN

MODE_CHK	;스위치 값 읽어서 모드 변경 분기문
	CALL	DELAY
	
	INCF	MOD_CNT
	MOVF	MOD_CNT,W
	SUBLW	.4
	BTFSC	STATUS,ZF
	CLRF	MOD_CNT
	
	MOVF	MOD_CNT,W
	ANDLW	03H
	ADDWF	PCL,F
	GOTO	M_LOOP
	GOTO	SEC_LOOP
	GOTO	CHANGE
	GOTO	ALARM
;------------------------------------	
MAIN_ST;
	CLRF	DISP_CNT
	CLRF	INT_CNT
	CLRF	MOD_CNT
	CLRF	C_CNT
	CLRF	A_CNT
	CLRF	TEMP
	CLRF	D_10SEC
	CLRF	D_1SEC
	CLRF	D_1MIN
	CLRF	D_10MIN
	CLRF	D_1HOUR
	CLRF	D_10HOUR
	CLRF	A_1SEC
	CLRF	A_10SEC
	CLRF	A_1MIN
	CLRF	A_10MIN
	CLRF	A_1HOUR
	CLRF	A_10HOUR
	BSF		PORTA,4
	CLRF	TEMP2
	
M_LOOP	
	BTFSS	PORTB,3	;스위치1번을 누르면 모드변경 부 프로그램 이동
	GOTO	MODE_CHK
	MOVLW	.244
	SUBWF	INT_CNT,W
	BTFSC	STATUS,ZF
	GOTO	M_LOOP1
	GOTO	M_LOOP

M_LOOP1	
	CALL	R_LOOP
;timer 인터럽트 발생할 때마다 1초 증가.
;관련된 변수들도 조건 충족 시 1씩 증가.
CK_LOOP		
	CLRF	INT_CNT	
	INCF 	D_1SEC 
	MOVF	D_1SEC,W
	SUBLW 	.10
	BTFSC 	STATUS,ZF
	CLRF	D_1SEC
	BTFSC 	STATUS,ZF
	INCF	D_10SEC
	
	MOVF	D_10SEC,W
	SUBLW 	.6	
	BTFSC 	STATUS,ZF
	CLRF	D_10SEC	
	BTFSC 	STATUS,ZF
	INCF	D_1MIN	

	MOVF	D_1MIN,W
	SUBLW	.10
	BTFSC 	STATUS,ZF
	CLRF	D_1MIN	
	BTFSC 	STATUS,ZF
	INCF	D_10MIN

	MOVF	D_10MIN,W
	SUBLW 	.6	
	BTFSC 	STATUS,ZF
	CLRF	D_10MIN	
	BTFSC	STATUS,ZF
	CALL	JUST
	BTFSC 	STATUS,ZF
	INCF	D_1HOUR
	
	
	MOVF	D_1HOUR,W
	SUBLW	.4
	BTFSC	STATUS,ZF
	CALL	TIMEUP 	; 24시가 되면 RESET
	
	MOVF	D_1HOUR
	SUBLW	.10
	BTFSS	STATUS,ZF
	GOTO	ALARM_TEST
		
	CLRF	D_1HOUR
	INCF	D_10HOUR
	GOTO	ALARM_TEST

JUST
	BCF		PORTA,4
	GOTO	JUST2
JUST2
	CALL	ADELAY
	INCF	TEMP2
	INCF	D_1SEC
	MOVF	TEMP2,W
	SUBLW	.3
	BTFSS	STATUS,ZF
	GOTO	JUST
	DECF	D_1SEC
	CLRF	TEMP2
	BSF		PORTA,4
	RETURN
	
	
TIMEUP	;10시간 변수 2와 비교
	MOVF	D_10HOUR,W
	ANDLW	0FH
	SUBLW	.2
	BTFSC	STATUS,ZF
	CALL	ALL_CLR	
	RETURN
	
ALL_CLR	;TIMEUP에서 넘어오면 변수들 초기화
	MOVLW	.0
	MOVWF	D_1SEC
	MOVWF	D_10SEC
	MOVWF	D_1MIN
	MOVWF	D_10MIN
	MOVWF	D_1HOUR
	MOVWF	D_10HOUR
	RETURN
	
SEC_LOOP;초 표시를 할때 main문에서는 1초가 경과했는지 계속 비교함
	BTFSS	PORTB,3
	GOTO	MODE_CHK
	MOVLW	.244
	SUBWF	INT_CNT,W
	BTFSS	STATUS,ZF
	GOTO	SEC_LOOP
	GOTO	CK_LOOP		;1초가 경과하면 값 증가를 위해 CK_LOOP로

XLOOP
	GOTO	M_LOOP
	

CHANGE
CLOOP ;시간 변경 모드에서 0.5초에 번갈아 가면서 dot 깜박인다.
	MOVLW	.125
	SUBWF	INT_CNT,W
	BTFSC	STATUS,CF
	GOTO	DOTON
	GOTO	DOTOFF

DON1	;dot을 키기 위해 conv의 17번째 항목부터 참조
	MOVLW	10H
	IORWF	D_1MIN
	GOTO	DOT
DON2
	MOVLW	10H
	IORWF	D_10MIN
	GOTO	DOT
DON3
	MOVLW	10H
	IORWF	D_1HOUR
	GOTO	DOT
DON4
	MOVLW	10H
	IORWF	D_10HOUR
	GOTO	DOT
	
DOFF1	;dot을 끄기 위해 conv의 1번째 항목부터 참조
	MOVLW	0FH
	ANDWF	D_1MIN
	GOTO	DOT
DOFF2	
	MOVLW	0FH
	ANDWF	D_10MIN
	GOTO	DOT
DOFF3	
	MOVLW	0FH
	ANDWF	D_1HOUR
	GOTO	DOT
DOFF4	
	MOVLW	0FH
	ANDWF	D_10HOUR
	GOTO	DOT
DOT	;mode2 시간 변경 기능
	BTFSS	PORTB,3
	GOTO	MODE_CHK
	
	BTFSS	PORTB,4	;모드 변경에서 두번째 스위치를 누르면 
	CALL	MOVE_LEFT	;dot의 위치를 왼쪽으로 옮긴다.
	MOVF	C_CNT,W
	SUBLW	.4
	BTFSC	STATUS,ZF
	CLRF	C_CNT
	
	BTFSS	PORTB,5	;스위치 3번을 누르면 시간 증가 
	GOTO	INC_NUM
	
	MOVLW	.244
	SUBWF	INT_CNT,W
	BTFSC	STATUS,ZF
	GOTO	CLOOP1
	GOTO	CLOOP
		

;; 각 변수 값 증가 
INC_1
	INCF	D_1MIN
	GOTO	INC_S
INC_2
	INCF	D_10MIN
	GOTO	INC_S
INC_3
	INCF	D_1HOUR
	GOTO	INC_S
INC_4
	INCF	D_10HOUR
	GOTO	INC_S

CLOOP1	;시간 변경 중에도 계속 시간이 흐른다 
	INCF	D_1SEC
		
INC_S	;시간 변경 중에도 값이 일정 이상 넘어가면 조절해준다.
	CLRF	INT_CNT
	
	MOVF	D_1SEC,W
	ANDLW	0FH
	SUBLW	.10
	BTFSC	STATUS,ZF
	CLRF	D_1SEC
	BTFSC	STATUS,ZF
	INCF	D_10SEC
	
	MOVF	D_10SEC,W
	ANDLW	0FH
	SUBLW	.6
	BTFSC	STATUS,ZF
	CLRF	D_10SEC
	BTFSC	STATUS,ZF
	INCF	D_1MIN
	
	MOVF	D_1MIN,W
	ANDLW	0FH
	SUBLW	.10
	BTFSC	STATUS,ZF
	CLRF	D_1MIN
	BTFSC	STATUS,ZF
	INCF	D_10MIN
	
	MOVF	D_10MIN,W
	ANDLW	0FH
	SUBLW	.6
	BTFSC	STATUS,ZF
	CLRF	D_10MIN
	BTFSC	STATUS,ZF
	INCF	D_1HOUR
	
	MOVF	D_1HOUR,W
	ANDLW	0FH
	SUBLW	.10
	BTFSC	STATUS,ZF
	CLRF	D_1HOUR
	BTFSC	STATUS,ZF
	INCF	D_10HOUR
	
	MOVF	D_10HOUR,W
	ANDLW	0FH
	SUBLW	.3
	BTFSC	STATUS,ZF
	CLRF	D_10HOUR
	
	MOVF	D_1HOUR,W
	ANDLW	0FH
	SUBLW	.4
	BTFSC	STATUS,ZF
	CALL	TIMEUP
	
	GOTO	CLOOP	
	
MOVE_LEFT	;;바꾸고 싶은 자리로 변경 
	INCF	C_CNT
	
R_LOOP		;;시간 표시할때 혼선이 생기지 않도록 conv에 접근할때 4자리만 쓰도록 함 
	MOVLW	0FH
	ANDWF	D_1MIN
	MOVLW	0FH
	ANDWF	D_10MIN
	MOVLW	0FH
	ANDWF	D_1HOUR
	MOVLW	0FH
	ANDWF	D_10HOUR
	CALL	DELAY
	RETURN
	
INC_NUM
	CALL	DELAY
	GOTO	INCE
;	
ALARM;mode3 알람 설정 기능
ALOOP
	;MOVLW	.125
	;SUBWF	INT_CNT,W
	BTFSC	INT_CNT,5
	GOTO	ALARM_DOTON
	GOTO	ALARM_DOTOFF
;알람 설정시 dot on
AD1
	MOVLW	10H
	IORWF	A_1MIN
	GOTO	ADOT
AD2
	MOVLW	10H
	IORWF	A_10MIN
	GOTO	ADOT
AD3
	MOVLW	10H
	IORWF	A_1HOUR
	GOTO	ADOT
AD4
	MOVLW	10H
	IORWF	A_10HOUR
	GOTO	ADOT
;알람 설정 시 dot off
ADO1
	MOVLW	0FH
	ANDWF	A_1MIN
	GOTO	ADOT
ADO2
	MOVLW	0FH
	ANDWF	A_10MIN
	GOTO	ADOT
ADO3
	MOVLW	0FH
	ANDWF	A_1HOUR
	GOTO	ADOT
ADO4
	MOVLW	0FH
	ANDWF	A_10HOUR
	GOTO	ADOT
	
ADOT
	BTFSS	PORTB,3	;스위치 1번 누르면 다시 모드 변경
	GOTO	MODE_CHK
	
	BTFSS	PORTB,4	;스위치 2번 누르면 자리 수 왼쪽으로 이동 
	CALL	MOV_ALARM
	MOVF	A_CNT,W
	SUBLW	.4
	BTFSC	STATUS,ZF
	CLRF	A_CNT
	
	BTFSS	PORTB,5	;스위치 3번 누르면 값 증가 
	GOTO	INC_ALARM
	
	MOVLW	.244
	SUBWF	INT_CNT,W
	BTFSC	STATUS,ZF
	GOTO	M_LOOP1
	GOTO	ALOOP

MOV_ALARM	;A_CNT 변수를 이용해 자리 수 이동
	INCF	A_CNT
	MOVLW	0FH
	ANDWF	A_1MIN
	MOVLW	0FH
	ANDWF	A_10MIN
	MOVLW	0FH
	ANDWF	A_1HOUR
	MOVLW	0FH
	ANDWF	A_10HOUR
	CALL	DELAY
	RETURN
;;증가하고자 하는 자리에 도착해서 스위치 3번 누를 때 값 증가
INC_A1
	INCF	A_1MIN
	GOTO	INC_SA
INC_A2
	INCF	A_10MIN
	GOTO	INC_SA
INC_A3
	INCF	A_1HOUR
	GOTO	INC_SA
INC_A4
	INCF	A_10HOUR
	GOTO	INC_SA
	
INC_SA;값 증가 시키더라도 값이 일정 이상 넘어가면 적절하게 동기화 해준다
	CLRF	INT_CNT
	MOVF	A_1SEC,W
	ANDLW	0FH
	SUBLW	.10
	BTFSC	STATUS,ZF
	CLRF	A_1SEC
	BTFSC	STATUS,ZF
	INCF	A_10SEC
	
	MOVF	A_10SEC,W
	ANDLW	0FH
	SUBLW	.6
	BTFSC	STATUS,ZF
	CLRF	A_10SEC
	BTFSC	STATUS,ZF
	INCF	A_1MIN
	
	MOVF	A_1MIN,W
	ANDLW	0FH
	SUBLW	.10
	BTFSC	STATUS,ZF
	CLRF	A_1MIN
	BTFSC	STATUS,ZF
	INCF	A_10MIN
	
	MOVF	A_10MIN,W
	ANDLW	0FH
	SUBLW	.6
	BTFSC	STATUS,ZF
	CLRF	A_10MIN
	BTFSC	STATUS,ZF
	INCF	A_1HOUR
	
	MOVF	A_1HOUR,W
	ANDLW	0FH
	SUBLW	.10
	BTFSC	STATUS,ZF
	CLRF	A_1HOUR
	BTFSC	STATUS,ZF
	INCF	A_10HOUR
	
	MOVF	A_10HOUR,W
	ANDLW	0FH
	SUBLW	.3
	BTFSC	STATUS,ZF
	CLRF	A_10HOUR
		
	MOVF	A_10HOUR,W
	ANDLW	0FH
	SUBLW	.4
	BTFSC	STATUS,ZF
	CALL	TIMEUP_AL
	
	GOTO	ALOOP
;알람 설정시 시/분 표시를 해주는 코드
AL_DISP1 
	MOVF	A_10MIN,W
	CALL	CONV
	MOVWF	PORTC
	BCF		PORTB,2
	RETURN
AL_DISP2
	MOVF	A_1MIN,W
	CALL	CONV
	MOVWF	PORTC
	BCF		PORTB,1
	INCF	INT_CNT
	RETURN
AL_DISP3
	MOVF	A_10HOUR,W
	CALL	CONV
	MOVWF	PORTC
	BCF		PORTA,3
	RETURN
AL_DISP4
	MOVF	A_1HOUR,W
	CALL	CONV
	MOVWF	PORTC
	BCF		PORTA,2
	RETURN
	
INC_ALARM
	CALL	DELAY
	GOTO	INCE_A

ALARM_TEST;알람 설정한 값들을 하위 니블로 masking 한다.
	MOVLW	0FH
	ANDWF	A_1MIN
	MOVLW	0FH
	ANDWF	A_10MIN
	MOVLW	0FH
	ANDWF	A_1HOUR
	MOVLW	0FH
	ANDWF	A_10HOUR
;1초 부터 설정한 시간을 다 비교하여 다 정확하게 일치하는지 확인한다. 
;하나라도 일치하지 않으면 NO_ALARM으로 이동 한다.
	MOVF	D_1SEC,W
	SUBWF	A_1SEC,W
	BTFSS	STATUS,ZF
	GOTO	NO_ALARM
	MOVF	D_10SEC,W
	SUBWF	A_10SEC,W
	BTFSS	STATUS,ZF
	GOTO	NO_ALARM
	MOVF	D_1MIN,W
	SUBWF	A_1MIN,W
	BTFSS	STATUS,ZF
	GOTO	NO_ALARM
	MOVF	D_10MIN,W
	SUBWF	A_10MIN,W
	BTFSS	STATUS,ZF
	GOTO	NO_ALARM
	MOVF	D_1HOUR,W
	SUBWF	A_1HOUR,W
	BTFSS	STATUS,ZF
	GOTO	NO_ALARM
	MOVF	D_10HOUR,W
	SUBWF	A_10HOUR,W
	BTFSS	STATUS,ZF
	GOTO	NO_ALARM
	GOTO	YES_ALARM
	
NO_ALARM;일치하지 않을 시 buzzer는 울리지 않는다.
	BSF		PORTA,4
	MOVF	MOD_CNT,W
	SUBLW	.3
	BTFSC	STATUS,ZF
	GOTO	ALOOP
	GOTO	M_LOOP
YES_ALARM;일치시 알람이 울린다.
	BCF		PORTA,4
	BTFSC	PORTB,5
	GOTO	SUB2
	GOTO	NO_ALARM
SUB2;프로세서의 속도로 인해 buzzer가 제대로 울리지 않으므로 1초와 거의 유사한 delay를 준다.
	CALL	ADELAY
	INCF	TEMP
	INCF	D_1SEC
	MOVF	TEMP,W
	SUBLW	.4
	BTFSS	STATUS,ZF
	GOTO	YES_ALARM
	CLRF	TEMP
	GOTO	NO_ALARM

DELAY
	MOVLW	.40
	MOVWF	DBUF1
LP4	MOVLW	.50
	MOVWF	DBUF2
LP5	NOP
	DECFSZ	DBUF2,F
	GOTO	LP5
	DECFSZ	DBUF1,F	
	GOTO 	LP4

	BTFSS	PORTB,3
	GOTO 	DELAY
	BTFSS	PORTB,4
	GOTO 	DELAY
	BTFSS	PORTB,5
	GOTO 	DELAY

	RETURN
	
ADELAY;buzzer를 동작시키기 위한 delay함수
	MOVLW	.10
	MOVWF	DBUF0

LP_1
	MOVLW	.125
	MOVWF	DBUF1
LP_2
	MOVLW	.200
	MOVWF	DBUF2
LP_3
	BCF		PORTA,4
	DECFSZ	DBUF2,F
	GOTO	LP_3
	DECFSZ	DBUF1,F
	GOTO	LP_2
	DECFSZ	DBUF0,F
	GOTO	LP_1


	RETURN

END

