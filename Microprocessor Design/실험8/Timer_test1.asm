; STANDARD HEADER FILE
	PROCESSOR	16F876
;
; BANK 0
INDF	EQU	00H
TMR0	EQU	01H
PCL		EQU	02H
STATUS	EQU	03H
FSR		EQU	04H
PORTA	EQU	05H
PORTB	EQU	06H
PORTC	EQU	07H
EEDATA	EQU	08H
EEADR	EQU	09H
PCLATH	EQU	0AH
INTCON	EQU	0BH
RCSTA	EQU	18H
TXREG	EQU	19H
; BANK 1
OPTIONR	EQU	81H
TRISA	EQU	85H
TRISB	EQU	86H
TRISC	EQU	87H
EECON1	EQU	88H
EECON2	EQU	89H
TXSTA	EQU	98H
SPBRG	EQU	99H
ADCON1	EQU	9FH
;
IRP		EQU	7
RP1		EQU	6
RP0		EQU	5
NOT_TO	EQU	4
NOT_PD	EQU	3
ZF		EQU	2
DC		EQU	1
CF		EQU	0
;
;

W		EQU	B'0'
F		EQU	.1
DBUF1 	EQU 24H ;GPR레지스터에 저장 (중요)
DBUF2 	EQU 25H ;GPR레지스터에 저장 (중요)
DBUF3 	EQU 26H ;GPR레지스터에 저장 (중요)
COM_B	EQU 27H
COM_C	EQU	28H
INT_CNT	EQU	30H
D_10SEC	EQU	31H
D_1SEC	EQU	32H
KEY_IN	EQU	33H
W_TEMP	EQU	34H
STATUS_TEMP	EQU	35H
DISP_CNT	EQU	36H

;
ORG		0
GOTO	START_UP
ORG		4
;ISR 시작번지
MOVWF	W_TEMP
SWAPF	STATUS,W
MOVWF	STATUS_TEMP
CALL	DISP
SWAPF	STATUS_TEMP,W
MOVWF	STATUS
SWAPF	W_TEMP,F
SWAPF	W_TEMP,W
BCF		INTCON,2
RETFIE

;DISPLAY ROUTINE
DISP
	BTFSS	DISP_CNT,0
	GOTO	DISP1
	GOTO	DISP2
DISP1
	MOVLW	00H
	MOVWF	PORTA
	MOVF	D_10SEC,W
	CALL	CONV
	MOVWF	PORTC
	BSF	PORTA,1
	BSF	DISP_CNT,0
	RETURN
DISP2
	MOVLW	00H
	MOVWF	PORTA
	MOVF	D_1SEC,W
	CALL	CONV
	MOVWF	PORTC
	BSF		PORTA,0
	BCF		DISP_CNT,0
	INCF	INT_CNT
	RETURN
;	
;MAIN PROGRAM
START_UP
	BSF		STATUS,RP0
	MOVLW	B'00000111'
	MOVWF	ADCON1
	MOVLW	B'00000000'
	MOVWF	TRISA
	MOVLW	B'00000000'
	MOVWF	TRISC
	MOVLW	B'00000010';2.048msec
	MOVWF	OPTIONR
	BCF		STATUS,RP0
	BSF		INTCON,5;TIMER INTERRUPT ENABLE
	BSF		INTCON,7;GLOBAL INTERRUPT ENABLE
	GOTO	MAIN_ST
MAIN_ST;모든 변수 초기화
	CLRF	INT_CNT
	CLRF	D_10SEC
	CLRF	D_1SEC
	CLRF	KEY_IN
M_LOOP
	MOVLW	.244
	SUBWF	INT_CNT,W
	BTFSS	STATUS,ZF
	GOTO	XLOOP
CK_LOOP
	CLRF	INT_CNT
	INCF	D_1SEC
	MOVLW	.10
	SUBWF	D_1SEC,W
	BTFSS	STATUS,ZF
	GOTO	XLOOP
	CLRF	D_1SEC
	INCF	D_10SEC
	MOVLW	.10
	SUBWF	D_10SEC,W
	BTFSC	STATUS,ZF
	CLRF	D_10SEC
	GOTO	XLOOP
XLOOP
	
	GOTO	M_LOOP
	
CONV	
	ANDLW	0FH
	ADDWF	PCL,F
		
	RETLW	B'00000011' ;'0'
	RETLW	B'10011111'	;'1'
	RETLW	B'00100101'	;'2'
	RETLW	B'00001101'	;'3'
	RETLW	B'10011001'	;'4'
	RETLW	B'01001001'	;'5'
	RETLW	B'01000001'	;'6'
	RETLW	B'00011111'	;'7'
	RETLW	B'00000001'	;'8'
	RETLW	B'00001001'	;'9'
	RETLW	B'00010001'
	RETLW	B'11000001'
	RETLW	B'01100011'
	RETLW	B'10000101'
	RETLW	B'01100001'
	RETLW	B'01110001'

END

